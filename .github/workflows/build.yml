name: PR Manual Approval

on:
  issue_comment:
    types: [created]
  pull_request_target:  # pour que le check soit visible
    types: [opened, reopened, edited]

jobs:
  # job “fake” juste pour avoir le check pending
  placeholder:
    name: Manual PR Approval
    runs-on: ubuntu-latest
    outputs:
      approved: ${{ steps.check.outputs.approved }}
    steps:
      - id: check
        run: |
          if [[ "${{ github.event_name }}" == "issue_comment" ]] && [[ "${{ github.event.comment.body }}" == "/approve" ]]; then
            echo "approved=true" >> $GITHUB_OUTPUT
            echo "Approved by $GITHUB_ACTOR"
          else
            echo "approved=false" >> $GITHUB_OUTPUT
            echo "Waiting for /approve"

  # job réel qui ne run que sur commentaire
  firmware-build:
    if: needs.placeholder.outputs.approved == 'true'
    runs-on: ubuntu-latest
    needs: placeholder
    steps:
      - name: Summary and Download Instructions
        run: echo "### Build Summary"
